<div id="dbContainer" class="catDB">
  <script type="text/javascript">
    dojo.require('dojo.date.stamp');
    dojo.ready(function() {
      uow.app.catalog.parseExamples('dbContainer');
      var db = uow.getDatabase({database: 'catalog', collection : 'status'});
      var d = dojo.date.stamp.toISOString(new Date(), {zulu : true});
      db.newItem({from : window.location.toString(), dt: d});
      db.save({
        onComplete: function() {
          uow.app.catalog.serviceStatus('Database', true);
        },
        onError: function() {
          uow.app.catalog.serviceStatus('Database', false);
        }
      });
    });
  </script>
  <h1>Database</h1>
  <p>Data persistence services are provided by a <a href="http://www.mongodb.org/">MongoDB</a> on the server and access using the <a href="http://dojotoolkit.org/reference-guide/dojo/data.html">dojo.data</a> interfaces on the client. 

  <h2>Links</h2>
  <ul>
    <li><a href="http://dojotoolkit.org/reference-guide/dojo/data.html">dojo.data documentation</a></li>
    <li><a href="http://docs.dojocampus.org/dojox/data/JsonRestStore">dojox.data.JsonRestStore documentation</a></li>
    <li><a href="http://www.mongodb.org/display/DOCS/Home">MongoDB documentation</a></li>
  </ul>

  <h2>Examples</h2>
  <h3>Save a new person object in the <em>rolodex</em> collection of the <em>catalog</em> database</h3>
  <label>
    First name <input type="text" id="db_ex1first"/>
  </label>
  <label>
    Last name <input type="text" id="db_ex1last" />
  </label>
  <button id="db_ex1">Run</button></label>
  <div id="db_ex1code">
    <pre><code dojoType="dojox.highlight.Code"
>var a = uow.getDatabase({database: 'catalog', collection : 'rolodex'});
var fn = dojo.byId('db_ex1first');
var ln = dojo.byId('db_ex1last');
a.newItem({firstName : fn.value, lastName : ln.value});
a.save();
fn.value = ln.value = '';
</code></pre>
  </div>

  <h3>Get 5 person objects from the <em>rolodex</em> collection in the <em>catalog</em> database <button id="db_ex2">Run</button></h3>
  <label for="db_ex1log">Results</label>
  <textarea class="results" id="db_ex1log"></textarea>
  <div id="db_ex2code">
    <pre><code dojoType="dojox.highlight.Code"
>var a = uow.getDatabase({database: 'catalog', collection : 'rolodex'});
var i = 1;
a.fetch({
  count: 5,
  onBegin: function() {
    dojo.byId('db_ex1log').innerHTML = 'Fetching.\n';
  },
  onItem: function(item) {
    var text = dojo.replace('{i}. {item.lastName}, {item.firstName}\n', 
      {i: i++, item : item});
    dojo.byId('db_ex1log').innerHTML += text;
  },
  onComplete: function(items) {
    dojo.byId('db_ex1log').innerHTML += 'Done.\n';
  },
  onError: function(e) {
    dojo.byId('db_ex1log').innerHTML += 'Kaboom. Bad things happened.\n';
  }
});</code></pre>
  </div>
</div>