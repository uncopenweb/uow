<div id="dbContainer" class="catDB">
  <script type="text/javascript">
    dojo.require('dojo.date.stamp');
    dojo.ready(function() {
      uow.app.catalog.parseExamples('dbContainer');
      uow.getDatabase({database: 'catalog', collection : 'status'})
      .addCallback(function(db) {
        var d = dojo.date.stamp.toISOString(new Date(), {zulu : true});
        db.newItem({from : window.location.toString(), dt: d});
        db.save({
          onComplete: function() {
            // saved to database
            uow.app.catalog.serviceStatus('Database', true);
          },
          onError: function() {
            // failed to save to database
            uow.app.catalog.serviceStatus('Database', false);
          }
        });
      }).addErrback(function() {
        // failed to get client instance
        uow.app.catalog.serviceStatus('Database', false);
      });
    });
  </script>
  <h1>Database</h1>
  <p>Data persistence services are provided by a <a href="http://www.mongodb.org/">MongoDB</a> on the server and access using the <a href="http://dojotoolkit.org/reference-guide/dojo/data.html">dojo.data</a> interfaces on the client. 

  <h2>Links</h2>
  <ul>
    <li><a href="http://dojotoolkit.org/reference-guide/dojo/data.html">dojo.data documentation</a></li>
    <li><a href="http://docs.dojocampus.org/dojox/data/JsonRestStore">dojox.data.JsonRestStore documentation</a></li>
    <li><a href="http://www.mongodb.org/display/DOCS/Home">MongoDB documentation</a></li>
  </ul>
  
  <h2>API</h2>
  <p><code>uow.getDatabase(args) &rarr; dojo.Deferred</code></p>
  <p>This method initializes the database interface for use in your application. You can call this function any number of times to get references to different databases and collections.</p>
  <p>The <tt>args</tt> parameter must have the following attributes configuring your access to the database:</p>
  
  <dl>
    <dt>database (string)</dt>
    <dd>Name of the database to access.</dd>
    <dt>collection (string)</dt>
    <dd>Name of the collection in the database to access.</dd>
  </dl>
  
  <p>The return value is a <tt><a href="http://www.dojotoolkit.org/reference-guide/dojo/Deferred.html">dojo.Deferred</a></tt>. You should invoke <tt>addCallback</tt> on the deferred to register a callback function that will receive a <a href="http://parente.github.com/jsonic/js.html#the-jsonic-interface"><tt>info.mindtrove.JSonic</tt> instance</a> for your use.</p>

  <h2>Examples</h2>
  <h3>Save a new person object in the <em>rolodex</em> collection of the <em>catalog</em> database</h3>
  <label>
    First name <input type="text" id="db_ex1first"/>
  </label>
  <label>
    Last name <input type="text" id="db_ex1last" />
  </label>
  <button id="db_ex1">Run</button></label>
  <div id="db_ex1code">
    <pre><code dojoType="dojox.highlight.Code"
>var def = uow.getDatabase({database: 'catalog', collection : 'rolodex'});
def.addCallback(function(db) {
  var fn = dojo.byId('db_ex1first');
  var ln = dojo.byId('db_ex1last');
  db.newItem({firstName : fn.value, lastName : ln.value});
  db.save();
  fn.value = ln.value = '';
});
</code></pre>
  </div>

  <h3>Get 5 person objects from the <em>rolodex</em> collection in the <em>catalog</em> database <button id="db_ex2">Run</button></h3>
  <label for="db_ex1log">Results</label>
  <textarea class="results" id="db_ex1log"></textarea>
  <div id="db_ex2code">
    <pre><code dojoType="dojox.highlight.Code"
>var def = uow.getDatabase({database: 'catalog', collection : 'rolodex'});
def.addCallback(function(db) {
  var i = 1;
  db.fetch({
    count: 5,
    onBegin: function() {
      dojo.byId('db_ex1log').innerHTML = 'Fetching.\n';
    },
    onItem: function(item) {
      var text = dojo.replace('{i}. {item.lastName}, {item.firstName}\n', 
        {i: i++, item : item});
      dojo.byId('db_ex1log').innerHTML += text;
    },
    onComplete: function(items) {
      dojo.byId('db_ex1log').innerHTML += 'Done.\n';
    },
    onError: function(e) {
      dojo.byId('db_ex1log').innerHTML += 'Kaboom. Bad things happened.\n';
    }
  });
});</code></pre>
  </div>
</div>